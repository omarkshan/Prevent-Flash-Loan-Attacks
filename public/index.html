<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.25.3"/><title data-react-helmet="true">Home | Prevent Flash Loan Attacks</title><meta data-react-helmet="true" name="description" content="dedicated to preventing flash loan attacks by sharing information and bringing to light all the rough things that have happened."/><meta data-react-helmet="true" property="og:title" content="Home"/><meta data-react-helmet="true" property="og:description" content="dedicated to preventing flash loan attacks by sharing information and bringing to light all the rough things that have happened."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="PreventFlashLoanAttacks"/><meta data-react-helmet="true" name="twitter:title" content="Home"/><meta data-react-helmet="true" name="twitter:description" content="dedicated to preventing flash loan attacks by sharing information and bringing to light all the rough things that have happened."/><style data-styled="" data-styled-version="5.2.1">.CWDxU{text-align:left;margin:1em 0;padding:0.5em;overflow:auto;}/*!sc*/
data-styled.g1[id="CodeBlock__Pre-v7tozj-0"]{content:"CWDxU,"}/*!sc*/
.cCevCI{display:table-row;}/*!sc*/
data-styled.g2[id="CodeBlock__Line-v7tozj-1"]{content:"cCevCI,"}/*!sc*/
.cHEauq{display:table-cell;text-align:right;padding-right:1em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0.5;}/*!sc*/
data-styled.g3[id="CodeBlock__LineNo-v7tozj-2"]{content:"cHEauq,"}/*!sc*/
.hvRYIH{display:table-cell;}/*!sc*/
data-styled.g4[id="CodeBlock__LineContent-v7tozj-3"]{content:"hvRYIH,"}/*!sc*/
.dtAQEJ{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;place-content:center;}/*!sc*/
data-styled.g7[id="Center-w8y2jp-0"]{content:"dtAQEJ,"}/*!sc*/
.hUOvcc{width:100%;padding-left:20px;padding-right:20px;margin:auto;}/*!sc*/
@media (min-width:576px){.hUOvcc{max-width:800px;}}/*!sc*/
data-styled.g8[id="Container-sc-16oo9fs-0"]{content:"hUOvcc,"}/*!sc*/
.hFQnpx{position:fixed;height:100%;width:300px;z-index:1001;}/*!sc*/
data-styled.g9[id="Aside__Content-hwascm-0"]{content:"hFQnpx,"}/*!sc*/
.iOxZAW{position:fixed;z-index:1000;height:100%;width:100px;}/*!sc*/
.iOxZAW .Aside__Content-hwascm-0{-webkit-transition:all 0.5s;transition:all 0.5s;-webkit-transform:translateX(-300px);-ms-transform:translateX(-300px);transform:translateX(-300px);}/*!sc*/
.iOxZAW:hover .Aside__Content-hwascm-0{-webkit-transform:translateX(0px);-ms-transform:translateX(0px);transform:translateX(0px);}/*!sc*/
data-styled.g10[id="Aside__Wrapper-hwascm-1"]{content:"iOxZAW,"}/*!sc*/
.kMPlwy{margin-bottom:20px;}/*!sc*/
data-styled.g11[id="pages__Section-guhi7n-0"]{content:"kMPlwy,"}/*!sc*/
.gOapk{height:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
data-styled.g12[id="pages__TableOfContent-guhi7n-1"]{content:"gOapk,"}/*!sc*/
.gRzezx{box-shadow:0px 5px 10px 0px rgba(0,0,0,0.25);-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;background-color:#fff;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:10px;padding:20px;min-height:70%;border-radius:4px;width:90%;}/*!sc*/
data-styled.g13[id="pages__TableOfContentNav-guhi7n-2"]{content:"gRzezx,"}/*!sc*/
</style><link rel="icon" href="/Prevent-Flash-Loan-Attacks/favicon-32x32.png?v=4191ad1f07d7f6e74c0032f9ce83bb0a" type="image/png"/><link rel="manifest" href="/Prevent-Flash-Loan-Attacks/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/Prevent-Flash-Loan-Attacks/icons/icon-48x48.png?v=4191ad1f07d7f6e74c0032f9ce83bb0a"/><link rel="apple-touch-icon" sizes="72x72" href="/Prevent-Flash-Loan-Attacks/icons/icon-72x72.png?v=4191ad1f07d7f6e74c0032f9ce83bb0a"/><link rel="apple-touch-icon" sizes="96x96" href="/Prevent-Flash-Loan-Attacks/icons/icon-96x96.png?v=4191ad1f07d7f6e74c0032f9ce83bb0a"/><link rel="apple-touch-icon" sizes="144x144" href="/Prevent-Flash-Loan-Attacks/icons/icon-144x144.png?v=4191ad1f07d7f6e74c0032f9ce83bb0a"/><link rel="apple-touch-icon" sizes="192x192" href="/Prevent-Flash-Loan-Attacks/icons/icon-192x192.png?v=4191ad1f07d7f6e74c0032f9ce83bb0a"/><link rel="apple-touch-icon" sizes="256x256" href="/Prevent-Flash-Loan-Attacks/icons/icon-256x256.png?v=4191ad1f07d7f6e74c0032f9ce83bb0a"/><link rel="apple-touch-icon" sizes="384x384" href="/Prevent-Flash-Loan-Attacks/icons/icon-384x384.png?v=4191ad1f07d7f6e74c0032f9ce83bb0a"/><link rel="apple-touch-icon" sizes="512x512" href="/Prevent-Flash-Loan-Attacks/icons/icon-512x512.png?v=4191ad1f07d7f6e74c0032f9ce83bb0a"/><link href="https://fonts.googleapis.com/css?family=Open+Sans:400;600;700&amp;display=swap" rel="stylesheet"/><link as="script" rel="preload" href="/Prevent-Flash-Loan-Attacks/webpack-runtime-a3dfa8ba617821c8c0df.js"/><link as="script" rel="preload" href="/Prevent-Flash-Loan-Attacks/framework-11348fb0fa7c3ad87864.js"/><link as="script" rel="preload" href="/Prevent-Flash-Loan-Attacks/app-9f1a36a3a0d031a1da53.js"/><link as="script" rel="preload" href="/Prevent-Flash-Loan-Attacks/a3336d3c033a5ec9d59a088cb032c68b95c64a61-db4fb3606c3852168a13.js"/><link as="script" rel="preload" href="/Prevent-Flash-Loan-Attacks/component---src-pages-index-tsx-8c89e213f07edfcd4afa.js"/><link as="fetch" rel="preload" href="/Prevent-Flash-Loan-Attacks/page-data/index/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/Prevent-Flash-Loan-Attacks/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/Prevent-Flash-Loan-Attacks/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><aside class="Aside__Wrapper-hwascm-1 iOxZAW"><div class="Aside__Content-hwascm-0 hFQnpx"><div class="pages__TableOfContent-guhi7n-1 gOapk"><nav class="pages__TableOfContentNav-guhi7n-2 gRzezx"><h5 role="button">Abstract</h5><h5 role="button">Historic Attacks</h5><h5 role="button">What is Flash Loan?</h5><h5 role="button">Types of Attacks?</h5><h5 role="button">More Details</h5></nav></div></div></aside><div class="Center-w8y2jp-0 dtAQEJ"><svg width="232" height="258" viewBox="0 0 232 258" fill="none"><g clip-path="url(#clip0)"><path d="M24.1991 95.622L66.0694 111.076L88.644 98.484L84.607 88.042L24.1991 95.622Z" fill="#C0232C"></path><path d="M167.234 143.985L208.232 160.614L171.421 165.523L147.531 161.661L164.392 143.985H167.234Z" fill="#C0232C"></path><path d="M183.543 126.881L144.014 168.344L85.019 230.221L59.3557 257.137L71.035 230.221L97.89 168.344L105.104 151.724L50.9764 126.881L74.8198 103.357L137.543 41.4798L178.712 0.862503L162.067 41.4798L137.254 102.032L139.724 103.357L183.543 126.881Z" fill="#FED947"></path><path d="M137.254 102.032L74.8198 103.357L137.543 41.4799H162.067L137.254 102.032Z" fill="#F8BE32"></path><path d="M218.916 95.622H24.1991L59.9229 33.7451H231.436L218.916 95.622Z" fill="#E4222E"></path><path d="M144.014 168.344L85.019 230.221H71.0349L97.89 168.344H144.014Z" fill="#F8BE32"></path><path d="M195.712 222.491H0.995102L36.7189 160.614H208.232L195.712 222.491Z" fill="#E4222E"></path><path d="M84.0508 66.9883V73H80.5352V55.9375H87.1914C88.4727 55.9375 89.5977 56.1719 90.5664 56.6406C91.543 57.1094 92.293 57.7773 92.8164 58.6445C93.3398 59.5039 93.6016 60.4844 93.6016 61.5859C93.6016 63.2578 93.0273 64.5781 91.8789 65.5469C90.7383 66.5078 89.1562 66.9883 87.1328 66.9883H84.0508ZM84.0508 64.1406H87.1914C88.1211 64.1406 88.8281 63.9219 89.3125 63.4844C89.8047 63.0469 90.0508 62.4219 90.0508 61.6094C90.0508 60.7734 89.8047 60.0977 89.3125 59.582C88.8203 59.0664 88.1406 58.8008 87.2734 58.7852H84.0508V64.1406ZM102.344 66.7539H99.543V73H96.0273V55.9375H102.367C104.383 55.9375 105.938 56.3867 107.031 57.2852C108.125 58.1836 108.672 59.4531 108.672 61.0938C108.672 62.2578 108.418 63.2305 107.91 64.0117C107.41 64.7852 106.648 65.4023 105.625 65.8633L109.316 72.8359V73H105.543L102.344 66.7539ZM99.543 63.9062H102.379C103.262 63.9062 103.945 63.6836 104.43 63.2383C104.914 62.7852 105.156 62.1641 105.156 61.375C105.156 60.5703 104.926 59.9375 104.465 59.4766C104.012 59.0156 103.312 58.7852 102.367 58.7852H99.543V63.9062ZM121.621 65.6055H114.871V70.1758H122.793V73H111.355V55.9375H122.77V58.7852H114.871V62.8516H121.621V65.6055ZM131.16 68.7695L135.027 55.9375H138.941L133 73H129.332L123.414 55.9375H127.316L131.16 68.7695ZM150.824 65.6055H144.074V70.1758H151.996V73H140.559V55.9375H151.973V58.7852H144.074V62.8516H150.824V65.6055ZM167.934 73H164.418L157.574 61.7734V73H154.059V55.9375H157.574L164.43 67.1875V55.9375H167.934V73ZM183.496 58.7852H178.27V73H174.754V58.7852H169.598V55.9375H183.496V58.7852Z" fill="white"></path><path d="M74.2383 196.484H68.0742L66.9023 200H63.1641L69.5156 182.938H72.7734L79.1602 200H75.4219L74.2383 196.484ZM69.0234 193.637H73.2891L71.1445 187.25L69.0234 193.637ZM92.1914 185.785H86.9648V200H83.4492V185.785H78.293V182.938H92.1914V185.785ZM107.238 185.785H102.012V200H98.4961V185.785H93.3398V182.938H107.238V185.785ZM117.48 196.484H111.316L110.145 200H106.406L112.758 182.938H116.016L122.402 200H118.664L117.48 196.484ZM112.266 193.637H116.531L114.387 187.25L112.266 193.637ZM137.133 194.316C137 196.152 136.32 197.598 135.094 198.652C133.875 199.707 132.266 200.234 130.266 200.234C128.078 200.234 126.355 199.5 125.098 198.031C123.848 196.555 123.223 194.531 123.223 191.961V190.918C123.223 189.277 123.512 187.832 124.09 186.582C124.668 185.332 125.492 184.375 126.562 183.711C127.641 183.039 128.891 182.703 130.312 182.703C132.281 182.703 133.867 183.23 135.07 184.285C136.273 185.34 136.969 186.82 137.156 188.727H133.641C133.555 187.625 133.246 186.828 132.715 186.336C132.191 185.836 131.391 185.586 130.312 185.586C129.141 185.586 128.262 186.008 127.676 186.852C127.098 187.688 126.801 188.988 126.785 190.754V192.043C126.785 193.887 127.062 195.234 127.617 196.086C128.18 196.938 129.062 197.363 130.266 197.363C131.352 197.363 132.16 197.117 132.691 196.625C133.23 196.125 133.539 195.355 133.617 194.316H137.133ZM144.785 193.156L142.957 195.125V200H139.441V182.938H142.957V190.672L144.504 188.551L148.852 182.938H153.176L147.117 190.52L153.352 200H149.168L144.785 193.156ZM163.523 195.523C163.523 194.859 163.289 194.352 162.82 194C162.352 193.641 161.508 193.266 160.289 192.875C159.07 192.477 158.105 192.086 157.395 191.703C155.457 190.656 154.488 189.246 154.488 187.473C154.488 186.551 154.746 185.73 155.262 185.012C155.785 184.285 156.531 183.719 157.5 183.312C158.477 182.906 159.57 182.703 160.781 182.703C162 182.703 163.086 182.926 164.039 183.371C164.992 183.809 165.73 184.43 166.254 185.234C166.785 186.039 167.051 186.953 167.051 187.977H163.535C163.535 187.195 163.289 186.59 162.797 186.16C162.305 185.723 161.613 185.504 160.723 185.504C159.863 185.504 159.195 185.688 158.719 186.055C158.242 186.414 158.004 186.891 158.004 187.484C158.004 188.039 158.281 188.504 158.836 188.879C159.398 189.254 160.223 189.605 161.309 189.934C163.309 190.535 164.766 191.281 165.68 192.172C166.594 193.062 167.051 194.172 167.051 195.5C167.051 196.977 166.492 198.137 165.375 198.98C164.258 199.816 162.754 200.234 160.863 200.234C159.551 200.234 158.355 199.996 157.277 199.52C156.199 199.035 155.375 198.375 154.805 197.539C154.242 196.703 153.961 195.734 153.961 194.633H157.488C157.488 196.516 158.613 197.457 160.863 197.457C161.699 197.457 162.352 197.289 162.82 196.953C163.289 196.609 163.523 196.133 163.523 195.523Z" fill="white"></path><path d="M90.4756 122.772L97.2887 125.823L96.1346 128.4L86.1128 123.913L93.0854 108.34L96.294 109.777L90.4756 122.772ZM113.421 127.216C112.734 128.749 111.861 129.972 110.802 130.885C109.743 131.797 108.567 132.34 107.273 132.515C105.987 132.692 104.692 132.488 103.387 131.904C102.096 131.326 101.083 130.501 100.349 129.427C99.6139 128.353 99.2254 127.118 99.1832 125.721C99.1443 124.317 99.4564 122.864 100.12 121.364L100.465 120.594C101.151 119.061 102.029 117.836 103.098 116.919C104.178 115.999 105.359 115.454 106.643 115.284C107.936 115.11 109.232 115.313 110.529 115.894C111.827 116.475 112.838 117.304 113.563 118.382C114.297 119.456 114.678 120.7 114.703 122.115C114.739 123.527 114.415 124.995 113.732 126.521L113.421 127.216ZM110.485 125.055C111.216 123.422 111.479 122.05 111.275 120.94C111.07 119.83 110.426 119.032 109.342 118.547C108.265 118.064 107.246 118.113 106.285 118.693C105.326 119.265 104.481 120.359 103.75 121.975L103.41 122.734C102.698 124.324 102.438 125.689 102.63 126.827C102.822 127.966 103.467 128.781 104.565 129.273C105.641 129.755 106.657 129.705 107.611 129.122C108.569 128.532 109.413 127.429 110.145 125.814L110.485 125.055ZM122.417 136.316L116.791 133.797L114.285 136.527L110.873 134.999L123.643 122.022L126.616 123.353L125.473 141.536L122.061 140.009L122.417 136.316ZM118.821 131.586L122.714 133.329L123.367 126.624L118.821 131.586ZM139.591 147.857L136.382 146.421L134.724 133.378L130.136 143.624L126.927 142.187L133.9 126.615L137.108 128.051L138.768 141.121L143.365 130.853L146.563 132.285L139.591 147.857Z" fill="white"></path></g></svg><h1>Prevent Flash Loan Attacks</h1></div><div class="Container-sc-16oo9fs-0 hUOvcc"><section id="s0" class="pages__Section-guhi7n-0 kMPlwy"><h1>Abstract</h1><p>This site is dedicated to information about flash loan attacks (which are usually just price oracle attacks) and how to stop them. For a study done by the Imperial College London, check out this deep dive on the historic bZx flash loan (oracle manipulation) attack for more information. The first step you can take, is to use decentralized oracles when working with data, a number of the projects that had issues moved themselves to <a title="Chainlink" href="https://chain.link">Chainlink</a> Price Feeds and are now secure. This is an open source project.</p><p>If you’d like to help fund Gitcoin grants for research, please consider <a title="View 0xb14B375f47ebf34BCDB9b914d1Ce28f775440778 on Etherscan.io" href="https://etherscan.io/address/0xb14B375f47ebf34BCDB9b914d1Ce28f775440778">donating</a>.</p></section><section id="s1" class="pages__Section-guhi7n-0 kMPlwy"><h1>Historic Attacks</h1><table><thead><tr><th>Protocol</th><th>Reference</th><th>Date</th><th>Value (USD)</th><th>Transaction</th><th>Cause</th><th>Fix</th></tr></thead><tbody><tr><td>bZx (1)</td><td><a href="https://quantstamp.com/blog/10-quick-and-dirty-facts-about-the-bzx-hacks">QuantStamp</a></td><td>Feb-15-2020</td><td>300k</td><td><a href="https://etherscan.io/tx/0xb5c8bd9430b6cc87a0e2fe110ece6bf527fa4f170a4bc8cd032f768fc5219838">Etherscan</a></td><td>Pump and Arbitrage</td><td>?</td></tr><tr><td>bZx (2)</td><td><a href="https://quantstamp.com/blog/10-quick-and-dirty-facts-about-the-bzx-hacks">QuantStamp</a></td><td>Feb-15-2020</td><td>645k</td><td><a href="https://etherscan.io/tx/0x762881b07feb63c436dee38edd4ff1f7a74c33091e534af56c9f7d49b5ecac15">Etherscan</a></td><td>Oracle Attack</td><td><a href="https://bzx.network/blog/chainlink-oracles">Chainlink Integration</a></td></tr><tr><td>Origin Protocol</td><td><a href="https://www.coindesk.com/origin-protocol-loses-3-25m-in-latest-flash-loan-attack-reports">CoinDesk</a></td><td>Nov-17-2020</td><td>7M</td><td><a href="https://etherscan.io/tx/0xe1c76241dda7c5fcf1988454c621142495640e708e3f8377982f55f8cf2a8401">Etherscan</a></td><td>Re-entrancy Attack</td><td>None</td></tr><tr><td>Harvest.Finance</td><td><a href="https://www.coindesk.com/harvest-finance-24m-attack-triggers-570m-bank-run-in-latest-defi-exploit">CoinDesk</a></td><td>Oct-26-2020</td><td>24M</td><td><a href="https://etherscan.io/tx/0xb460b70f11a93364fecf1f3c3ec49f053aecd2d6d9912c012170aa7a0de2d526">Etherscan</a></td><td>Oracle Attack</td><td>None</td></tr><tr><td>Value Defi</td><td><a href="https://www.coindesk.com/value-defi-suffers-6m-flash-loan-attack">CoinDesk</a></td><td>Nov-14-2020</td><td>6M</td><td><a href="https://etherscan.io/tx/0x46a03488247425f845e444b9c10b52ba3c14927c687d38287c0faddc7471150a">Etherscan</a></td><td>Oracle Attack</td><td><a href="https://decrypt.co/48892/value-defi-hacked-chainlink">Chainlink Integration</a></td></tr><tr><td>Akropolis</td><td><a href="https://www.coindesk.com/defi-project-akropolis-token-pool-drained">CoinDesk</a></td><td>Nov-12-2020</td><td>2M</td><td><a href="https://etherscan.io/tx/0xf15623567231c67df2b8bcc5540236fbda2c3ac11ecbec427048f11b582cb869">Etherscan</a></td><td>Re-entrancy Attack</td><td>Re-Entry Check added</td></tr><tr><td>Cheese Bank</td><td><a href="https://cointelegraph.com/news/value-defi-protocol-suffers-6-million-flash-loan-exploit">CoinTeleGraph</a></td><td>Nov-14-2020</td><td>6M</td><td><a href="https://etherscan.io/tx/0x46a03488247425f845e444b9c10b52ba3c14927c687d38287c0faddc7471150a">Etherscan</a></td><td>Oracle Attack</td><td>None</td></tr></tbody></table></section><section id="s2" class="pages__Section-guhi7n-0 kMPlwy"><h1>What is A Flash Loan?</h1><p>A flash loan is a loan that is only valid within one blockchain transaction. Flash loans fail, if the borrower does not repay its debt before the end of the transaction borrowing the loan. That is, because a blockchain transaction can be reverted during its execution, if the condition of a repayment is not satisfied.</p><p>We can then see some easy attack vectors using this tool.</p><ol><li>Take out a massive loan (token A) from a protocol supporting flash loans</li><li>Swap token A for token B on a DEX, dumping the price of A</li><li>Deposit the purchased token B as collateral on a DeFi protocol that uses the above DEX as its sole price feed, and borrow even more with this manipulated price</li><li>Use a portion of borrowed token A to fully pay back the original flash loan and keep the remaining tokens, (profiting here)</li></ol></section><section id="s3" class="pages__Section-guhi7n-0 kMPlwy"><h1>Types of attacks</h1><h2>Oracle Manipulation</h2><p>Also known as Price Oracle Attacks. This seems to be the #1 cause of attacks at the moment, by far. What is important to note, is that decentralized exchanges are not decentralized oracles. Using Uniswap, Sushiswap, or Curve to get pricing information to execute trades is pulling data from potocols whose price depends soley on liquidity. Looking at the infamous ground zero bZx attack that sparked this wave of attacks, we can see exactly what happens. These flash loans are used to crash and manipulate the price of these decentralized exchanges, which most projects deemed safe to use. The issue here relies in the fact that these protocols prices depend entirely on liquidity.</p><p>See the above section for what something like this would look like.</p><h3>Prevention</h3><p>The easiest way to solve this is to use <a href="https://blog.chain.link/flash-loans-and-the-importance-of-tamper-proof-oracles/">decentralized oracles</a>. <a href="https://feeds.chain.link/">Chainlink Price Feeds</a> are the leading decentralized oracle provider, and you can see that the vast majority of the protocols end up adding Chainlink to fix these attacks. If the data (price or otherwise) you&#x27;re looking for isn&#x27;t there yet, you can always request new decentralized networks or <a href="https://docs.chain.link/docs/make-a-http-get-request">build your own</a>.</p><h3>Prevention Example</h3><p>Let&#x27;s take a look at some malicious pseudo-code, pretend these are each ERC20s.</p><div><pre class="CodeBlock__Pre-v7tozj-0 CWDxU prism-code language-javascript" style="background-color:#2a2734;color:#9a86fd"><div class="CodeBlock__Line-v7tozj-1 cCevCI token-line" style="color:#9a86fd"><span class="CodeBlock__LineNo-v7tozj-2 cHEauq">1</span><span class="CodeBlock__LineContent-v7tozj-3 hvRYIH"><span class="token plain">uint256 priceOfMyGovernanceTokenInETH </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> dexTokenETHPairPrice</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="CodeBlock__Line-v7tozj-1 cCevCI token-line" style="color:#9a86fd"><span class="CodeBlock__LineNo-v7tozj-2 cHEauq">2</span><span class="CodeBlock__LineContent-v7tozj-3 hvRYIH"><span class="token plain">myGovernanceToken</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token method function property-access" style="color:#9a86fd">transfer</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> priceOfMyGovernanceTokenInETH</span><span class="token punctuation" style="color:#6c6783">)</span></span></div></pre></div><p>This right here should be the easiest red flag on the planet. If you ever do a transfer based on a centralized price oracle, you&#x27;re asking to get owned. One way or another.</p><p>Check the <a href="https://docs.chain.link/docs/get-the-latest-price">Chainlink documentation for decentralized price feeds</a></p><div><pre class="CodeBlock__Pre-v7tozj-0 CWDxU prism-code language-javascript" style="background-color:#2a2734;color:#9a86fd"><div class="CodeBlock__Line-v7tozj-1 cCevCI token-line" style="color:#9a86fd"><span class="CodeBlock__LineNo-v7tozj-2 cHEauq">1</span><span class="CodeBlock__LineContent-v7tozj-3 hvRYIH"><span class="token keyword module" style="color:#ffcc99">import</span><span class="token plain"> </span><span class="token string" style="color:#ffcc99">&quot;@chainlink/contracts/src/v0.6/interfaces/AggregatorV3Interface.sol&quot;</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="CodeBlock__Line-v7tozj-1 cCevCI token-line" style="color:#9a86fd"><span class="CodeBlock__LineNo-v7tozj-2 cHEauq">2</span><span class="CodeBlock__LineContent-v7tozj-3 hvRYIH"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// constructor and getLatestPrice function truncated</span><span class="token plain"></span></span></div><div class="CodeBlock__Line-v7tozj-1 cCevCI token-line" style="color:#9a86fd"><span class="CodeBlock__LineNo-v7tozj-2 cHEauq">3</span><span class="CodeBlock__LineContent-v7tozj-3 hvRYIH"><span class="token plain">uint256 priceOfMyGovernanceTokenInETH </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">getLatestChainlinkPrice</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="CodeBlock__Line-v7tozj-1 cCevCI token-line" style="color:#9a86fd"><span class="CodeBlock__LineNo-v7tozj-2 cHEauq">4</span><span class="CodeBlock__LineContent-v7tozj-3 hvRYIH"><span class="token plain">myGovernanceToken</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token method function property-access" style="color:#9a86fd">transfer</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> priceOfMyGovernanceTokenInETH</span><span class="token punctuation" style="color:#6c6783">)</span></span></div></pre></div><h2>Reentrancy</h2><p>A reentrancy attack can occur when you create a function that makes an external call to another untrusted contract before it resolves any effects. If the attacker can control the untrusted contract, they can make a recursive call back to the original function, repeating interactions that would have otherwise not run after the effects were resolved.</p><h3>Prevention</h3><p><code>Send, Transfer, and Call</code></p><h3>Prevention Example</h3><div><pre class="CodeBlock__Pre-v7tozj-0 CWDxU prism-code language-javascript" style="background-color:#2a2734;color:#9a86fd"><div class="CodeBlock__Line-v7tozj-1 cCevCI token-line" style="color:#9a86fd"><span class="CodeBlock__LineNo-v7tozj-2 cHEauq">1</span><span class="CodeBlock__LineContent-v7tozj-3 hvRYIH"><span class="token keyword" style="color:#ffcc99">function</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">withdraw</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> external </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span></div><div class="CodeBlock__Line-v7tozj-1 cCevCI token-line" style="color:#9a86fd"><span class="CodeBlock__LineNo-v7tozj-2 cHEauq">2</span><span class="CodeBlock__LineContent-v7tozj-3 hvRYIH"><span class="token plain">    uint256 amount </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> balances</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="CodeBlock__Line-v7tozj-1 cCevCI token-line" style="color:#9a86fd"><span class="CodeBlock__LineNo-v7tozj-2 cHEauq">3</span><span class="CodeBlock__LineContent-v7tozj-3 hvRYIH"><span class="token plain">    </span><span class="token function" style="color:#9a86fd">require</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token property-access">call</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token method function property-access" style="color:#9a86fd">value</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="CodeBlock__Line-v7tozj-1 cCevCI token-line" style="color:#9a86fd"><span class="CodeBlock__LineNo-v7tozj-2 cHEauq">4</span><span class="CodeBlock__LineContent-v7tozj-3 hvRYIH"><span class="token plain">    balances</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">msg</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span></div><div class="CodeBlock__Line-v7tozj-1 cCevCI token-line" style="color:#9a86fd"><span class="CodeBlock__LineNo-v7tozj-2 cHEauq">5</span><span class="CodeBlock__LineContent-v7tozj-3 hvRYIH"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span></span></div></pre></div><h2>Pump and Arbitrage</h2><h3>Prevention</h3><h2>Safe Integer use and basic audits</h2><p>Everything that applies to basic contract safety applies to flash loan attack safety. Such as:</p><div><pre class="CodeBlock__Pre-v7tozj-0 CWDxU prism-code language-" style="background-color:#2a2734;color:#9a86fd"><div class="CodeBlock__Line-v7tozj-1 cCevCI token-line" style="color:#9a86fd"><span class="CodeBlock__LineNo-v7tozj-2 cHEauq">1</span><span class="CodeBlock__LineContent-v7tozj-3 hvRYIH"><span class="token plain">using SafeMath for uint256;</span></span></div></pre></div><p>Watch out for integer overflows, etc.</p></section><section id="s4" class="pages__Section-guhi7n-0 kMPlwy"><h1>More details, notes threads</h1><p>This will be a work in progress for us to get better at standards here. At the moment, I&#x27;m not sure how to address some of the liquidity issues. If you have a protocol that depends heavily on liquidity of another platform, you could very well be vulnerable.</p><p><a href="https://twitter.com/Dogetoshi/status/1326963117356625931">Akropolis Hack Tweet Thread</a></p><p><a href="https://quantstamp.com/blog/market-dynamics-of-the-1st-bzx-hack-part-1">bZx First attack</a></p><p><a href="https://academy.ivanontech.com/blog/defi-deep-dive-what-is-the-bzx-protocol">bZx Both attacks</a></p><p><a href="https://medium.com/coinmonks/protect-your-solidity-smart-contracts-from-reentrancy-attacks-9972c3af7c21">Reentry attacks</a></p><p><a href="https://consensys.net/diligence/blog/2019/09/stop-using-soliditys-transfer-now/">Using <code>call</code> over <code>transfer</code> or <code>send</code></a></p></section></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-2bdc720517636649befc.js"],"app":["/app-9f1a36a3a0d031a1da53.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-8d182377ad7fb53660a4.js"],"component---src-pages-abstract-mdx":["/component---src-pages-abstract-mdx-7883be978259f56f0089.js"],"component---src-pages-historic-attacks-mdx":["/component---src-pages-historic-attacks-mdx-c13c907d0c304aa2754b.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-8c89e213f07edfcd4afa.js"],"component---src-pages-more-details-mdx":["/component---src-pages-more-details-mdx-53209bb66f8e2a441307.js"],"component---src-pages-types-of-attacks-mdx":["/component---src-pages-types-of-attacks-mdx-969f770dc63a6f6977a4.js"],"component---src-pages-what-is-flash-loan-mdx":["/component---src-pages-what-is-flash-loan-mdx-872ac82c799d316e2807.js"]};/*]]>*/</script><script src="/Prevent-Flash-Loan-Attacks/polyfill-2bdc720517636649befc.js" nomodule=""></script><script src="/Prevent-Flash-Loan-Attacks/component---src-pages-index-tsx-8c89e213f07edfcd4afa.js" async=""></script><script src="/Prevent-Flash-Loan-Attacks/a3336d3c033a5ec9d59a088cb032c68b95c64a61-db4fb3606c3852168a13.js" async=""></script><script src="/Prevent-Flash-Loan-Attacks/app-9f1a36a3a0d031a1da53.js" async=""></script><script src="/Prevent-Flash-Loan-Attacks/framework-11348fb0fa7c3ad87864.js" async=""></script><script src="/Prevent-Flash-Loan-Attacks/webpack-runtime-a3dfa8ba617821c8c0df.js" async=""></script></body></html>